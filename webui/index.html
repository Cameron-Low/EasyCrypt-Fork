<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC
  "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

  <title>Editor</title>

  <link rel="stylesheet" href="codemirror/lib/codemirror.css">

  <style type="text/css">
  .CodeMirror {
       border-top: 1px solid black;
    border-bottom: 1px solid black;
      line-height: 1.1em;
  }

  .ec-read-only {
    background-color: #ccc;
  }

  #feedback {
    color: blue;
  }

  body {
    font-family: Droid Sans, Arial, sans-serif;
    line-height: 1.5;
    max-width: 64.3em;
    margin: 3em auto;
    padding: 0 1em;
    //position: absolute;
    //top:144px;
    //left: 125px;
  }

  //#box {}

  </style>

  <script src="jquery/jquery.js" type="text/javascript"></script>
  <script src="extracLine.js" type="text/javascript"></script>

  <script src="codemirror/lib/codemirror.js" type="text/javascript"></script>
  <script src="codemirror/mode/easycrypt/easycrypt.js" type="text/javascript"></script>
  <script src="codemirror/addon/edit/matchbrackets.js" type="text/javascript"></script>
  <script src="codemirror/addon/edit/foldcode.js" type="text/javascript"></script>

 <script type="text/javascript">
  $(document).ready(function() {
    var foldFunc = CodeMirror.newFoldFunction(CodeMirror.braceRangeFinder);
    var options = {
               mode: "text/x-easycrypt",
        lineNumbers: true,
         indentUnit: 4,
            tabMode: "shift",
      matchBrackets: true,
       lineWrapping: true,
          extraKeys: {"Ctrl-Q": function(cm){foldFunc(cm, cm.getCursor().line);}},
    };

    window.editor = CodeMirror.fromTextArea($("#code")[0], options);

    var ro_mark = null;

    function clear_ro_mark() {
      if (!ro_mark)
        return ;
      ro_mark.clear();
      ro_mark = null;
    }

    function set_read_only(end) {
      var opts = {
        className: 'ec-read-only',
         readOnly: true,
      };

      clear_ro_mark();
      ro_mark = window.editor.markText({ line: 0, ch: 0 }, end, opts);
    }

    editor.on("gutterClick", foldFunc);
    foldFunc(editor, 0);

    var i = -1;

    $("#next").click(function nextLine(editor) {
      var numLine = window.editor.lineCount(); //number of lines inside the editor
      if (i < numLine-1) {
        i++;
        var line = window.editor.getLine(i);
        $("#feedback").append("LINE SENT: " + (i+1) + " " + line + "\n");
      }
      set_read_only({ line: i+1, ch: 0 });
    });

    $("#prev").click(function prevLine(editor) {
      if (i >= 0)
      {
        i--;
        var line = window.editor.getLine(i);
        $("#feedback").append("LINE SENT: " + (i+1) + " " + line + "\n");
        set_read_only({ line: i+1, ch: 0 });
      }
    });

    $("#prev").onclick = function(){prevLine()};
  });
  </script>

</head>
<body>
<table width ="100%">
  <tr>
    <td>
        <h1>EasyCrypt editor</h1>
  <div id="contents">
    <textarea id="code" name="code">
theory group.
  type t.
  op neutral : t.
  op law(x:t, y:t):t.

  axiom NeutralLeft:
	forall (n:t), law(x,neutral) = x. {
        (*....*)
        (*...(*...*)...*)
        (*...(*..(*..*)..*)...*)
    }
  module m.
end group.</textarea>
  </div>
  <br>
  <br>
  <button id="next">Next line</button>  <button id="prev">Previous line</button>
  </td>
  <td>
      <h1 align="center">Feedback</h1>
  <div id="feed" align="center">
    <textarea id="feedback" name="feedback" rows= "25" cols="50" font="Arial"  readonly></textarea>
  </div>
   <br>
  <br>
  </td>
  </tr>
</table>

</body>
</html>
